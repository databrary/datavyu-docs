===============================
Data Viewer Controller Overview
===============================

The Data Viewer Controller enables users to manipulate the playback of 
their data source, and create new cells as they record their observations.

.. image:: /img/controller-annotated.*
   :alt: Image of the Data Viewer Controller indicating the track and keypad area
   :align: center

The Data Viewer Controller has two main areas: the keypad on the left,
which maps directly to your keypad, and the :guilabel:`Timeslider` on
the right, which represents the current playback position, and provides
additional functionality to control and customize playback.

The following sections describe the two areas in detail, and provide
a useful reference for working with the Data Viewer Controller.

Keypad
------

.. important:: 

   You cannot use the keypad for inputting numbers into Datavyu: it will
   only perform the actions described here.

The Data Viewer Controller's keypad maps directly to the number pad
on your keyboard or external keypad: the on-screen representation
helps users remember what key performs what function. When you press 
a key on the keypad, a visual indicator onscreen mirrors the
keystrokes.

.. note:: 

   The Data Viewer Controller maps playback controls to the keys of
   your keypad. Some keypads may change the ordering of certain keys:
   for instance, the top row might be ``clear``, ``/``, ``*``, ``-``,
   rather than ``clear``, ``*``, ``/``. Some keypads may have a ``Num
   Lock`` key rather than ``clear``. Familiarize yourself with both
   the Datavyu controls and your keypad to maximize coding efficiency.

.. _playback-controls:

Playback Controls
~~~~~~~~~~~~~~~~~

.. note:: 

   For users of Mac OS X: recent versions of OS X do not allow you to
   hold down a key as a default, instead it brings up a
   mini-menu to help you select common accents for that letter. If you
   want to be able to :guilabel:`jog` by holding down the ``1`` or
   ``3`` keys, you will need to open your Terminal and run the
   following command::

      defaults write -g ApplePressAndHoldEnabled -bool false

   To undo the change, run the same command but with ``-bool true``
   rather than ``-bool false``.

.. figure:: /img/keypad-annotated.*
   :align: right
   :figwidth: 300px

   The keys highlighted in pink are *playback controls*. The keys
   highlighted in brown are *coding-controls*.

- :guilabel:`jog left` (``1``): moves the playhead back one frame. If the
  :term:`frame rate` is not set, :guilabel:`jog` will move the playhead
  in one second increments. Holding down :guilabel:`jog left` plays
  backward slowly.

- :guilabel:`play/pause` (``2``): pauses playback. Pressing
  :guilabel:`play/pause` again resumes playback. :guilabel:`play/pause`
  only works if :guilabel:`play` has first been pushed.

- :guilabel:`jog right` (``3``): moves the playhead forward one frame. If the
  :term:`frame rate` is not set, :guilabel:`jog` will move the playhead
  in one second increments. Holding down :guilabel:`jog right` plays
  forward slowly.

- :guilabel:`shuttle left` (``4``): rewinds, initially at 1/32 of playback speed.
  Repeatedly pressing the :guilabel:`shuttle left` key increases the rewind
  speed to a maximum of 32 times playback speed.

- :guilabel:`stop` (``5``): stops playback.

- :guilabel:`shuttle right` (``6``): fast forwards initially at 1/32 of playback
  speed. Repeatedly pressing the :guilabel:`shuttle right` key increases
  the fast forward speed to a maximum of 32 times playback speed.

- :guilabel:`rewind` (``7``): rewinds at 32x playback speed.

- :guilabel:`play` (``8``): starts playback.

- :guilabel:`forward` (``9``): fast forwards at 32x playback speed.

In addition, ``shift`` :guilabel:`find` (``+``): jumps to the cell
:term:`offset`. 

.. _coding-controls:

Coding Controls
~~~~~~~~~~~~~~~

- :guilabel:`set cell onset` (``clear``): sets the :term:`onset` for the current
  observation / cell.

- :guilabel:`point cell` (``*``): creates a new cell whose :term:`onset` and
  :term:`offset` values are the playhead's current position.

- :guilabel:`set cell offset` (``/`` and ``.``): sets the :term:`offset` for the
  current observation / cell.

- :guilabel:`find` (``+``): moves the playhead to the onset time of
  the current cell, which is shown in the box to the right of the
  :guilabel:`find` button. Selecting a different cell will update this
  time.


- :guilabel:`go back` (``-``): moves the playhead back by the amount
  of time set in the box to the right of the :guilabel:`go back`
  button. You can change the increment by selecting that box and editing
  the value.

- :guilabel:`create new cell and set previous onset` (``0``): creates a new
  cell and sets its :term:`onset` to the playhead's current
  time. If the previous cell does not have a :term:`offset`,
  adding a new cell with this key sets the previous cell's
  :term:`offset` to the current playhead time, minus one millisecond.

- :guilabel:`create new cell` (``Enter``): creates a new cell and sets
  its :term:`onset` to the playhead's current time.

Tracks
------

The :guilabel:`Tracks` area of the Data Viewer controller helps you
visualize where you are within a data source's playback. You can
control the scale using the slider bar in the top right: moving it to
the right zooms in, allowing you to manipulate smaller time periods
than would otherwise be feasible. You can also zoom in on a selected
region by clicking on the :guilabel:`magnifying glass` icon next to
the slider bar. The red :term:`playhead` shows the current playback
position.

.. figure:: /img/tracks-region-annotated.svg
   :alt: annotated image of the data viewer controller's tracks region
   :align: center


You can choose to focus on a single region by moving the green region
dividers. Datavyu will start playback from the leftmost bracket's position,
and stop at the rightmost bracket.

The :guilabel:`Tracks` area of the Data Viewer Controller also
includes five buttons:

- :guilabel:`Lock All`: locks the tracks to prevent the user from
  changing the synchronization between multiple tracks.

- :guilabel:`Add Bookmark`: adds a bookmark at the playhead.

- :guilabel:`Snap Region`: sets the :term:`region` to the length of the selected
  cell: the left bracket is placed at the cell's :term:`onset`, and the
  right bracket at the cell's :term:`offset`. You can also use the
  ``ctrl +`` keyboard shortcut to snap the region.

- :guilabel:`Clear Region`: removes the region boundaries. You can
  also use the ``ctrl -`` keyboard shortcut to clear the region.

- :guilabel:`Magnifying Glass` icon: zooms in on the
  timeslider to focus exclusively on the snapped region.

.. _add-data-source:
.. _add-data:

Add Data
--------

.. image:: /img/keypad-add-data-button.*
   :alt: image of keypad with arrow indicating the "add data" button
   :align: right
   :width: 300px

Datavyu currently supports video through QT and VLC.
There are plans to develop plugins to support other data sources, such
as audio, physiology, motion, and eye tracking data. To convert video file types, see:
:ref:`convert-data-source-type`. If you are going to be working with
multiple data sources see: :ref:`add-multiple-sources`.

Providing you have adequate processing power and a
sufficiently strong graphics card, you should be able to work with
high-resolution video files without challenge.

To add a data source:

#. Click the :guilabel:`Add Dataâ€¦` button in the top left corner of the
   Data Viewer Controller.
   
#. A file selection window will open. Select the data file you will be
   coding.

#. If the data source is a video file, Datavyu will attempt to
   determine its :term:`frame rate`. If it is unable to determine the
   frame rate, it will ask you what the video's frame rate is. You can
   determine the frame rate by opening the video in QuickTime Player,
   and selectin :guilabel:`Show Movie Inspector` from the
   :guilabel:`Window` menu. The Inspector presents information about
   the video. The frame rate is labeled :guilabel:`FPS`, or
   frames-per-second.
   
   Datavyu uses frame rate to optimize playback and to :ref:`jog
   <playback-controls>`, so it is important that you set the correct
   frame rate.

.. seealso::

   - :doc:`/guide/spreadsheet`
   
   - :doc:`/guide/tutorials`
